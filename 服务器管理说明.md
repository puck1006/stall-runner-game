# 游戏服务器管理说明

## 📋 服务器信息

- **IP 地址**: 117.72.182.249
- **系统**: CentOS 6.9 64位
- **配置**: 2核 CPU, 4GB 内存, 5Mbps 带宽
- **用户名**: root
- **密码**: yongyu13!

## 🌐 访问地址

**游戏链接**: http://117.72.182.249/escape.html

## 📁 文件位置

- **游戏文件**: `/var/www/game/escape.html`
- **启动脚本**: `/root/start-game-server.sh`
- **日志文件**: `/var/log/game-server.log`
- **开机自启**: `/etc/rc.local`

## 🔧 服务管理命令

### 启动服务
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "/root/start-game-server.sh"
```

### 停止服务
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "pkill -f 'SimpleHTTPServer 80'"
```

### 重启服务
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "pkill -f 'SimpleHTTPServer 80' && sleep 2 && /root/start-game-server.sh"
```

### 查看服务状态
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "ps aux | grep 'SimpleHTTPServer 80' | grep -v grep"
```

### 查看实时日志
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "tail -f /var/log/game-server.log"
```

### 查看最近 50 条日志
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "tail -50 /var/log/game-server.log"
```

## 📤 更新游戏文件

### 方法 1: 使用 SCP 上传
```bash
cd /Users/tom/Desktop/摊位主理人_小游戏
scp -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa escape.html root@117.72.182.249:/var/www/game/
```

### 方法 2: 完整更新流程
```bash
# 1. 上传新文件
scp -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa escape.html root@117.72.182.249:/var/www/game/

# 2. 重启服务(可选,静态文件不需要重启)
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "/root/start-game-server.sh"
```

## 🔍 故障排查

### 1. 服务无法访问

**检查服务是否运行**:
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "ps aux | grep SimpleHTTPServer"
```

**检查端口是否监听**:
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "netstat -tlnp | grep :80"
```

**查看错误日志**:
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "tail -100 /var/log/game-server.log"
```

### 2. 服务意外停止

**重新启动**:
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "/root/start-game-server.sh"
```

### 3. 防火墙问题

**检查防火墙规则**:
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "iptables -L -n | grep 80"
```

## 🚀 开机自启动

服务已配置为开机自启动,服务器重启后会自动启动游戏服务。

**验证自启动配置**:
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "cat /etc/rc.local | grep start-game-server"
```

## 📊 监控访问

### 查看访问统计
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "grep 'escape.html' /var/log/game-server.log | wc -l"
```

### 查看最近访问
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "grep 'escape.html' /var/log/game-server.log | tail -20"
```

## ⚠️ 注意事项

1. **HTTP vs HTTPS**: 当前使用 HTTP,Supabase 可能会有跨域警告(但仍可正常工作)
2. **性能限制**: Python SimpleHTTPServer 适合中小规模访问,大流量建议升级到 Nginx
3. **日志清理**: 定期清理日志文件,避免占用过多磁盘空间
4. **备份**: 定期备份 `/var/www/game/` 目录

## 🔐 SSH 快捷配置

为了避免每次都输入密码,可以配置 SSH 密钥:

```bash
# 1. 生成密钥(如果还没有)
ssh-keygen -t rsa

# 2. 复制公钥到服务器
ssh-copy-id -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249

# 3. 之后就可以免密登录了
ssh root@117.72.182.249
```

## 📱 生成二维码

使用以下链接生成二维码供现场扫码:

**在线生成器**:
- https://cli.im/
- https://www.qrcode-monkey.com/

**输入链接**: http://117.72.182.249/escape.html

## 🎯 快速命令

### 一键重启服务
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "/root/start-game-server.sh"
```

### 一键查看状态
```bash
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@117.72.182.249 "ps aux | grep SimpleHTTPServer | grep -v grep && echo '---' && tail -5 /var/log/game-server.log"
```

---

**当前状态**: ✅ 服务正常运行
**最后更新**: 2025-10-30

