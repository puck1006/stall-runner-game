# 本地测试指南

## 🚀 快速开始

### 方法一: 使用 Python (推荐)

```bash
# 在项目目录下运行
python3 -m http.server 8000
```

然后访问:
- 游戏: http://localhost:8000/escape.html
- 速度测试工具: http://localhost:8000/速度测试.html

### 方法二: 使用 Node.js

```bash
# 安装 http-server (首次)
npm install -g http-server

# 启动服务器
http-server -p 8000
```

### 方法三: 使用 VS Code Live Server

1. 安装 "Live Server" 插件
2. 右键点击 `escape.html`
3. 选择 "Open with Live Server"

---

## 🎮 当前速度配置

### 已调整的参数

| 参数 | 值 | 说明 |
|------|-----|------|
| SPEED_SCREENS | 1.8 屏/秒 | 基础移动速度 |
| 虚拟摇杆最小速度 | 0.4x | 轻推摇杆时的速度 |
| 虚拟摇杆最大速度 | 1.0x | 完全推动摇杆时的速度 |
| 键盘速度 | 1.0x | WASD/方向键速度 |

### 速度示例 (不同分辨率)

**手机竖屏 (375 × 667)**:
- 最短边: 375px
- 基础速度: 1.8 × 375 = 675 px/s
- 虚拟摇杆: 270 ~ 675 px/s
- 键盘: 675 px/s

**平板横屏 (1024 × 768)**:
- 最短边: 768px
- 基础速度: 1.8 × 768 = 1382 px/s
- 虚拟摇杆: 553 ~ 1382 px/s
- 键盘: 1382 px/s

**电脑屏幕 (1920 × 1080)**:
- 最短边: 1080px
- 基础速度: 1.8 × 1080 = 1944 px/s
- 虚拟摇杆: 778 ~ 1944 px/s
- 键盘: 1944 px/s

---

## 🔧 调整速度

### 使用速度测试工具

1. 打开 `速度测试.html`
2. 调整滑块查看实时速度计算
3. 点击"打开游戏测试"按钮测试效果
4. 找到合适的速度值

### 手动修改代码

如果需要永久修改默认速度,编辑 `escape.html`:

**位置**: 第 364 行

```javascript
// 修改这个值 (当前 1.8)
const SPEED_SCREENS = Math.max(
  0.6,
  Math.min(
    4.0,
    Number(qs.get("spw")) ||
      Number(localStorage.getItem("escape_spw") || 1.8) ||  // ← 修改这里
      1.8  // ← 和这里
  )
);
```

**建议值**:
- `1.5` - 较慢,适合新手
- `1.8` - 当前默认,适中
- `2.2` - 较快,有挑战性
- `2.5` - 很快,高难度

### 通过 URL 参数临时调整

不修改代码,直接在 URL 中添加参数:

```
# 速度 1.5 倍
http://localhost:8000/escape.html?speed=1.5

# 每秒 2.5 屏
http://localhost:8000/escape.html?spw=2.5

# 组合使用
http://localhost:8000/escape.html?speed=1.2&spw=2.0
```

---

## 🧪 测试清单

### 基础测试
- [ ] 手机竖屏测试 (虚拟摇杆)
- [ ] 手机横屏测试 (虚拟摇杆)
- [ ] 平板测试 (虚拟摇杆)
- [ ] 电脑测试 (键盘 WASD)
- [ ] 电脑测试 (键盘方向键)

### 速度测试
- [ ] 轻推摇杆 - 速度是否太慢/太快?
- [ ] 完全推动摇杆 - 速度是否合适?
- [ ] 键盘移动 - 速度是否流畅?
- [ ] 对角线移动 - 速度是否一致?

### 兼容性测试
- [ ] 不同浏览器 (Chrome, Safari, Firefox)
- [ ] 不同刷新率 (60Hz, 120Hz, 144Hz)
- [ ] 不同分辨率 (小屏、中屏、大屏)
- [ ] 窗口缩放 - 速度是否保持一致?

### 游戏性测试
- [ ] 能否躲避敌人?
- [ ] 移动是否灵活?
- [ ] 是否有卡顿?
- [ ] 难度是否合适?

---

## 📊 性能监控

### 查看实时 FPS

在浏览器控制台运行:

```javascript
let lastTime = performance.now();
let frames = 0;
setInterval(() => {
  const now = performance.now();
  const fps = Math.round(frames * 1000 / (now - lastTime));
  console.log('FPS:', fps);
  frames = 0;
  lastTime = now;
}, 1000);

// 在游戏循环中添加
frames++;
```

### 查看速度值

在浏览器控制台运行:

```javascript
// 查看当前玩家速度
console.log('Player baseSpeed:', player.baseSpeed);
console.log('Player velX:', player.velX);
console.log('Player velY:', player.velY);
console.log('Actual speed:', Math.sqrt(player.velX**2 + player.velY**2));
```

---

## 🐛 常见问题

### Q: 速度还是太快/太慢怎么办?

A: 
1. 打开 `速度测试.html` 调整参数
2. 或直接修改 `escape.html` 第 364 行的 `1.8` 值
3. 建议范围: 1.2 ~ 2.5

### Q: 不同设备速度不一致?

A: 
- 检查是否使用了时间增量 `dt` (已实现)
- 确认 `baseSpeed` 是否正确计算 (已修复)
- 清除浏览器缓存重新加载

### Q: 虚拟摇杆不灵敏?

A: 
- 调整第 692 行的速度因子 (当前 0.4 ~ 1.0)
- 可以提高最小值,如改为 0.5 或 0.6

### Q: 键盘移动太快?

A: 
- 降低 `SPEED_SCREENS` 的值
- 或在键盘控制部分添加速度因子

---

## 📱 手机测试技巧

### 获取本机 IP

**Mac/Linux**:
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows**:
```bash
ipconfig | findstr IPv4
```

### 手机访问

1. 确保手机和电脑在同一 WiFi
2. 启动本地服务器: `python3 -m http.server 8000`
3. 手机浏览器访问: `http://你的IP:8000/escape.html`
4. 例如: `http://192.168.1.100:8000/escape.html`

### 生成二维码

使用在线工具生成二维码:
- https://cli.im/
- https://www.qrcode-monkey.com/

输入地址: `http://你的IP:8000/escape.html`

---

## 🎯 推荐配置

根据测试,以下配置较为平衡:

| 设备类型 | SPEED_SCREENS | 说明 |
|---------|---------------|------|
| 手机 | 1.8 - 2.0 | 当前默认 |
| 平板 | 1.6 - 1.8 | 稍慢一点 |
| 电脑 | 1.5 - 1.7 | 屏幕大,可以慢一点 |

可以通过检测屏幕尺寸自动调整,但目前统一使用 1.8 已经能适配大部分设备。

---

## ✅ 下一步

1. 启动本地服务器
2. 打开 `速度测试.html` 查看参数
3. 打开 `escape.html` 测试游戏
4. 根据手感调整速度
5. 确认满意后部署到线上

祝测试顺利! 🎮

